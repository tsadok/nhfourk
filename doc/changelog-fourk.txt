About this document:
Written 2014-2015 by Nathan Eady.

This document (i.e., this specific file, changelog-fourk.txt) is in
the public domain.  The author has specifically released it to the
public, choosing to waive any exclusivity rights that he might
otherwise have under copyright law, reserving none of them.  You
may read, modify, distribute, or otherwise use this document in
any manner that you deem appropriate.

At your option, you may choose instead to treat this document as being
under the NetHack General Public License.  In that case, see further
details about that license in libnethack/dat/license.

NetHack Fourk Changelog Overview:
=================================

This document describes the changes that have been made in NetHack
Fourk specifically, which are different from the upstream NetHack 4
codebase.  For changes made in NetHack 4, see instead changelog.txt

Thematically, the major changes fall into the following overall
categories:

 * Balance adjustments.  Various formulae have been revised, to
   improve the overall balance and difficulty curve of the game.
   Things like death-drop probability, engraving success rate,
   alignment record, etc. have had the shape of their curve adjusted,
   and some game features have been buffed or gently nerfed so that
   they fit better into the overall scheme of the game's balance.
   
 * Monster/class reorganization.  Some classes with very few monsters
   have been combined and thus freed up, so that in a subsequent
   version some heavily overloaded monster classes can be split,
   without running out of letters.  I tried to be conservative about
   this, and for now I tried to avoid having any monster look exactly
   the same as another monster used to look, when it can be avoided.
   
 * Differentiation (aka improved variety).  Some monsters, items, or
   special levels that were practically identical have been tweaked
   slightly so that they are no longer quite so closely the same.
   Some special levels may get new versions, as well.


Chronological Changelog (most recent at top):
=============================================
=============================================


Changes in 4.3.0.1:
-------------------

 * Shamelessly copied the multiple-bones-pools implementation from
   NAO, then enhanced it to keep separate pools for each game mode
   (normal, explore, wizmode, setseed, polyinit).

 * Some monsters have been given more interesting attacks.  Notably,
   pit fiends now have an attack that creates pits.

 * Fixing status ailments with a unicorn horn is now mostly free; the
   only penalty is that a blessed horn can become uncursed.  Blessed
   horns are now guaranteed to fix at least one trouble (assuming you
   have any they can fix).  However, restoring lost attributes with a
   unicorn horn now always degrades its enchantment.

 * When you lose alignment points, you now get warning messages
   about it.  You also get messages when you regain alignment.

 * Engraving Elbereth no longer exercises wisdom.

 * Engravings are no longer degraded by walking, and the probability
   that random actions or inactions (including resting, searching)
   will erode an engraving is greatly reduced.  However, engraving
   additional text degrades what is already there.

 * Lizards (specifically), acid blobs, F, P, and T are guaranteed to
   drop corpses for the first hundred kills per monster type.  This is
   mostly significant because it guarantees stoning remedies.  
   The F and P are thrown in just for flavor, T so they can revive.

 * The effect of weapon skill on chance to hit has been magnified,
   and being restricted is now worse than being unskilled.

 * Bugfix: the monstr value for floating eyes was being calculated
   incorrectly, due to the way they are implemented.  This was
   causing them to generate too often too early.

 * Added a digit to the version number, so I can do more than one
   release based on a given version of upstream, without getting my
   version numbers horribly out of sync.

 * The chance for thrown projectiles to break now depends primarily on
   your skill.  Enchanted objects get an extra chance to survive (and
   negatively enchanted ones get an extra chance to break).

 * You can now #untrap falling rock traps, obtaining rocks.
   Also, disarming a projectile trap (rocks, arrows, or darts)
   now produces a few more projectiles than previously.

 * Players who wish to use spears should be able to find more
   of them now, introduced via the monster inventory mechanism.

 * Quasits have been buffed slightly, because they're boring, but
   I don't want to just remove them if they can be made interesting.

 * Manes are now in the W mlet, with wraiths and ghosts and other
   spirits of the dead.  This fits their flavour much better than
   their previous mlet assignment and also reduces color conflicts.

 * Rings that are dropped down a sink end up buried in the ground
   under the sink.  They can be reclaimed by destroying the sink,
   drying up the resulting fountain, and digging up the rings,
   which will now be identified.

 * The backstab bonus now scales with your skill in whatever weapon
   you are using.  Currently, the bonus potentially goes as high as 28
   per hit if you are expert but falls off significantly at lower
   skill levels.  This change probably gives rogues a very powerful
   mid-game, without making them overpowered in the late game; but
   it will need play testing for balance.

 * Added single-use wish sources at the top of Vlad's tower
   and in Orcus Town.  (Update: and one in the Wizard's Tower.)

 * The Wizard of Yendor gets more starting inventory now.  Some
   of it might actually be useful at that stage of the game.

 * Cherry-picked the "monsters get better equipment in Gehennom"
   feature from the Gehennom Fun Patch.  Also, arrow traps in
   Gehennom may yield silver arrows.

 * Now that Sokoban is somewhat easier for the haters to bypass or
   deal with in some other way without properly solving it, we're
   free to add a few new Sokoban levels:
   + Add four new versions of Soko-1: "Boomerang Boulders", "Through
     the Cracks", "Easy Peasey", and "First Things First".  The two
     existing vanilla versions are retained also, for a total of six.
   + Add three new versions of Soko-2, for a total of four.
     The added versions are "Fly on the Wall", "Boulder Halls
     of Zim", and "Two-Phase".  One of the existing vanilla
     versions is also retained.  The infamous "Sokoban 2 B"
     (steelypips) aka "soko2a" (nethackwiki) is excluded.
   + Add two new versions of Soko-3, for a total of four.
     The new ones are "Bring 'em on Down" and "Slot Machine".
   + Add one new version of Soko-4, "'Ring 'em Around", with
     the prize being a ring of polymorph control.
   I have some reservations about a couple of these, but it's hard
   for me to be objective about them, since I created them.  I've
   included them for now, pending user feedback.

 * The Oracle can now sell you enlightenment, in addition to the
   other services.  Also, the prices are calculated differently,
   in a way that should make them lower in the early game.

 * Monkeys are better at stealing things and getting away.

 * Additional rocks are sometimes generated on the floor of rooms.
   This is mainly a balance change, to prevent sling users from
   trivially running out of ammo -- sling has to have _some_ kind
   of advantage, as it's worse than other ranged weapons in most
   ways.  However, it also makes flavor sense, IMO, to have a lot
   of rocks laying around.

 * Wands of wishing are no longer rechargeable.

 * Role rebalance, round one.
   + Starting inventory has been adjusted for some roles: a bit more
     ammo or an additional spell book; low-percentage-chance items are
     either guranteed or removed, or you get a consolation prize if
     you don't get them; healers get eucalyptus; some roles get small
     enchantment adjustments on starting equipment.
   + Several role/race and role/alignment combinations are permitted
     that previously were not, and in one case vice versa.
   + The Barbarian role has had its melee skill options and quest
     artifact buffed.  (The Heart can now be invoked for a
     remove-curse effect; Barbarians get the blessed remove curse
     effect; other roles get the uncursed effect.)
   + Valkyries, Knights, and Samurai have had their melee prowess
     reduced a bit (so that their melee options are worse than
     Barbarians) but are compensated in other ways.
     - Valkyries now start with a +3 spear and an attack spell and can
       find a spellbook of cone of cold on quest home.  Their casting
       abilities still need to be balanced so they can use attack
       spells without becomming general-purpose casters.  I may need
       to give them starting skill in attack, we'll see.
     - Knights can now get expert in crossbow, can find spare lances
       and a spare saddle on quest home, will not fall off and die
       when mounting their pony on turn 1, and will not break their
       lance while jousting if at least devoutly aligned.  Figuring
       out how to get to devout as early as possible under the Fourk
       alignment record formula is left as an exercise.
     - Samurai are guaranteed a longsword and some replacement ya and
       a saddle on the quest, and the Tsurugi now provides extrinsic
       speed when wielded.

 * Pulled in about fifty fixes for various vanilla bugs from an
   upstream "4.3 maintenance" branch.  The upstream master branch
   hasn't merged these changes yet for reasons involving release
   timing, but Fourk is at a different place in its dev cycle that
   makes them appropriate now.

 * The luck penalty in Sokoban can now be avoided by carrying a
   non-cursed luckstone or by hallucinating.  Also, the Sokoban luck
   penalty will never take your luck below -3.

 * The Statue of Perseus is now guaranteed to contain the shield of
   reflection and the sack (and the scimitar, just because).  This is
   mainly intended as a sop for players who insist on skipping
   Sokoban.  At least you don't have to do the Castle with no
   reflection and no container.

 * The differences between the different versions of Minetown have
   been enhanced.  Previously, several of them felt almost the same
   as one another.  Hopefully that is not the case now.

 * Barring bones, the only variant of Minetown that might not have a
   general store now is College Town, which has a guaranteed book
   shop, so you can at least easily price check scrolls (and books).

 * The Mimic of the Mines level has been made more interesting,
   bringing it somewhat closer to the other Mine's End levels in terms
   of both difficulty and loot.

 * Certain normally rare items are supplied in small numbers early in
   the game as floor items.  Specifically, filler levels at depth 2-6
   in the main dungeon each have an 80% chance to get one of these
   items, which is most often a scroll of scare monster but can also
   be wolfsbane, eucalytus, or a wand of enlightenment.

 * The ever controversial and rather boring Acehack/NetHack4 floating
   eye behavior (wherein you can't melee them at all) has been
   replaced with a new behavior that will probably be equally
   controversial but hopefully more interesting:  whatever hp damage
   you do to the floating eye you also sustain yourself, amplified
   proprortionally to your own experience level.  The exact formula
   may need to be tweaked, pending play testing.  The formula for
   monster-vs-monster is different from the formula for
   player-vs-monster, not because I think it should be, but because
   rebalancing player hitpoints vs monster hitpoints is a larger
   change that I didn't want to rush into yet.

 * Insteadeath by poison when you could have survived the damage
   will now only drain a level rather than killing you outright,
   if you are at least XL3.  Furthermore, starting characters have
   a 500-turn grace period to reach XL3 to protect against this.
   (You can still die by falling onto poisoned spikes or being hit by
   a poisoned weapon or whatever, if you do not have enough current HP
   to survive the damage that it does, or if you are running around
   at XL1 or XL2 past turn 500.)

 * The supply of rocks (embedded within the rock) has been increased,
   because slings are bad enough, compared to other launchers, without
   having to constantly worry about running out of rocks (which aren't
   even supposed to be the primary ammo; they're what you use when
   you're trying to conserve or have run out of flint and glass).

 * The Wizard of Yendor now has an attack that can change your
   alignment (law/neu/cha), but this effect is blocked if you are
   pious.  The main upshot of this is that early (pre-quest) alignment
   conversion no longer makes the game unwinnable, although it is
   still a significant inconvenience, since you will need to fight the
   Wizard before doing the quest, which is not the usual strategy.

 * The shopkeeper names list for general stores has been expanded,
   since that is the most common type of shop.  Also, some tool shop
   owners have been re-inserted into the list that were in (at least
   some ports of) 3.4.3 but had been removed at some point due to the
   #ifdef purge and/or platforms being dropped.  (This re-insert was
   not comprehensive.)

 * Arrows (against small monsters) and darts have been slightly
   buffed: one additional point of base damage.

 * Cherry-picked two trap-related changes from the Gehennom Fun Patch.
   Falling rock traps are no longer generated on levels 1-3 in the
   main dungeon, and when a monster is changed by a polymorph trap,
   there is now a chance for the trap to be used up.  The probability
   of this drops off deeper into the dungeon.  To be able to use the
   same polymorph trap on pets indefinitely with no chance of it being
   used up, you must find one at dungeon level 35 or deeper.

 * Made rock piercers brown, lurkers above red.  Eventually
   these will all be in mlet t (S_TRAPPER).

 * Marked umber hulks as HI_ULINE (i.e., underlined).  This
   is a pre-emptive measure, done for the same reason that xorns
   are now red:  eventually both of these large, distinctive,
   deep-rock-dwelling creatures are going to be in the same
   monster class together, probably mlet X (S_XORN), and I don't
   want either of them looking exactly the same as the other
   one used to look, if it can be avoided.

 * Moved leprechauns into the S_IMP (lowercase i) mlet class.
   For detailed justification, see the changelog entry (834cebee),
   but in brief, they are mischevious but usually not outright
   dangerous spirit/faerie beings appearing with a physical body,
   playing pranks, meddling, occasionally making people's fortunes,
   and there is folklore associated with capturing them, all of
   which is also true of imps and tengu.  Additionally, they are
   diminutive in stature like imps and quasits.  This reduces the
   number of in-use map characters by one, which is a Good Thing.
   To distinguish, leprechauns are bright green and homonculi are
   now gray (previously, both were green).

 * Differentiated nymphs.  Wood nymphs are the lowest-level and
   slightly easier to deal with than before (notably, they are now
   slightly slower than the player); water nymphs are a little
   tougher, and mountain nymphs are now the highest-level and most
   difficult nymphs.  They do NOT grow up into each other.  However,
   water nymphs (barring fountain schenanighans, which are always a
   player's fault) and especially mountain nymphs should now start
   showing up a little later in the game than before; wood nymphs
   should start showing up around the same time as before.

 * Changed the colors of two monsters (xorns to red, acid blobs to
   yellow, matching yellow dragons).  This is a pre-emptive measure
   to reduce color conflicts later, when certain monster classes
   eventually get combined.  Might as well let users go ahead and
   get used to the new colors for these monsters now.

 * Unicorn horns are now a technically finite resource (unless you can
   cast cancellation).  Cursed unicorn horns and the "Nothing happens"
   case are unchanged.

 * The formula for the player's odds of hitting monsters has been
   adjusted significantly.  Luck and experience level are now only
   added in on a logarithmic scale (together), meaning that always
   hitting everything no matter what is (hopefully) no longer a
   foregone conclusion in the late game.  It is to be expected that
   further tweaks to this formula will be required.

 * Disabled the "network MOTD" feature, since it requires a public
   server, which Fourk currently does not have.

 * Alignment record points are no longer granted for killing most
   kinds of monsters.

 * Gaining alignment record points through sacrifice is now somewhat
   more difficult (especially for non-chaotics); although certain
   kinds of special-cased corpses are still particularly effective.

 * Alignment record now starts at 10 for lawfuls, 15 for neutrals,
   20 for chaotics.  (These numbers may get adjusted later, not sure;
   as it stands, it means chaotics don't have to improve their record
   at all to go on the quest; lawfuls must improve it by 10.)  For
   now, the role-specific differences in starting alignment have been
   evened out; this may change later, as part of role differentiation,
   but I want to get the basic balance figured out first.

 * The chance for an engraving to be successfully written exactly as
   intended, rather than in a pre-eroded form, now starts higher than
   in 3.4.3 but falls off if you write Elbereth too many times.  The
   number of times you can write Elbereth and still keep a good chance
   of writing things successfully is proportional to experience level
   and is also somewhat better for forms of engraving that use up
   resources.  Players who use Elbereth sparingly in emergencies are
   likely to notice a positive effect on its reliability (if they know
   enough not to smudge it after writing it, write one at a time,
   etc.); players who abuse Elbereth extensively will definitely
   notice that it is less reliable now.  Failure is accompanied by
   messages about your body_part(HAND) cramping up.

 * To compensate for the reduced death drops as you kill many monsters
   of the same kind (which happens in normal play for some monsters,
   particularly common ones generated in groups), the base death drop
   probability has been adjusted upward.  Thus, the first few monsters
   you kill of any given type are now more likely to leave death drops
   than before.  This needs play testing for balance, but the
   intention is that the overall number of death drops in a typical
   normal (non-farming) game should be about the same.

 * Any given type of monster becomes less likely to drop corpses and
   death drops as you kill more and more of them.  Somewhere around 80
   kills you stop getting death drops from that type of monster, and
   somewhere around 225 kills, you stop getting corpses for that kind
   of monster.  This is expected to be most noticeable with puddings
   but may also be relevant for extinctionists and throne farmers.
   I'd have made it top out at a thousand or so kills, but the kill
   count only goes up to 255, probably so it can fit in a single byte.
   In any case, this is unlikely to be noticed in normal play except
   with large creatures such as dragons, which are no longer
   guaranteed to drop corpses every single time.

 * Updated branding, docs, build rules, and such to refer to nhfourk
   (for filenames) and NetHack Fourk (for human-readable names) where
   appropriate.  References to NetHack 4 and nethack4 have also been
   retained in many places, since that is the upstream codebase on
   which NetHack Fourk is based.
